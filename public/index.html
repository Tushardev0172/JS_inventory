<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JS - Inventory</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet" />
  <style>
    :root {
      --bg: #f5f2ec;
      --surface: #ffffff;
      --card: #faf8f4;
      --border: #e2ddd5;
      --border2: #ccc8bf;
      --ink: #1a1714;
      --ink2: #6b6560;
      --ink3: #9c9590;
      --accent: #2d6a4f;
      /* forest green â€” eco/paper vibe */
      --accent-l: #d8f0e5;
      --amber: #b45309;
      --amber-l: #fef3c7;
      --red: #b91c1c;
      --red-l: #fee2e2;
      --blue: #1d4ed8;
      --blue-l: #dbeafe;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.10);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Space Grotesk', sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh;
    }

    /* â”€â”€ TOP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .topbar {
      background: var(--ink);
      color: #fff;
      padding: 0 2rem;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-weight: 700;
      font-size: 1.05rem;
      letter-spacing: -0.3px;
    }

    .logo-icon {
      width: 28px;
      height: 28px;
      background: var(--accent);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .topbar-hint {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.4);
      font-family: 'JetBrains Mono', monospace;
    }

    /* â”€â”€ STATS ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1px;
      background: var(--border);
      border-bottom: 1px solid var(--border);
    }

    .stat {
      background: var(--surface);
      padding: 1rem 1.5rem;
    }

    .stat-label {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--ink3);
      margin-bottom: 0.3rem;
    }

    .stat-val {
      font-size: 1.5rem;
      font-weight: 700;
      line-height: 1.1;
    }

    .stat-sub {
      font-size: 0.7rem;
      color: var(--ink2);
      margin-top: 0.15rem;
      font-family: 'JetBrains Mono', monospace;
    }

    .stat-val.green {
      color: var(--accent);
    }

    .stat-val.amber {
      color: var(--amber);
    }

    .stat-val.red {
      color: var(--red);
    }

    /* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .layout {
      display: grid;
      grid-template-columns: 240px 1fr;
      min-height: calc(100vh - 56px - 80px);
    }

    /* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sidebar {
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 1.25rem 1rem;
      position: sticky;
      top: 56px;
      height: calc(100vh - 56px);
      overflow-y: auto;
    }

    .sidebar-section {
      margin-bottom: 1.5rem;
    }

    .sidebar-label {
      font-size: 0.63rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--ink3);
      padding: 0 0.5rem;
      margin-bottom: 0.5rem;
    }

    .search-wrap {
      position: relative;
      margin-bottom: 1.25rem;
    }

    .search-icon {
      position: absolute;
      left: 0.6rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--ink3);
      font-size: 0.85rem;
      pointer-events: none;
    }

    .search-input {
      width: 100%;
      padding: 0.55rem 0.75rem 0.55rem 2rem;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--ink);
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.82rem;
      border-radius: 6px;
      outline: none;
      transition: border-color 0.15s;
    }

    .search-input:focus {
      border-color: var(--accent);
    }

    .search-input::placeholder {
      color: var(--ink3);
    }

    .cat-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      background: none;
      border: none;
      color: var(--ink2);
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.82rem;
      padding: 0.45rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      text-align: left;
      transition: all 0.12s;
    }

    .cat-btn:hover {
      background: var(--bg);
      color: var(--ink);
    }

    .cat-btn.active {
      background: var(--accent-l);
      color: var(--accent);
      font-weight: 600;
    }

    .cat-icon {
      font-size: 0.95rem;
      width: 18px;
      text-align: center;
      flex-shrink: 0;
    }

    .cat-count {
      margin-left: auto;
      font-size: 0.68rem;
      background: var(--border);
      color: var(--ink2);
      padding: 0.1rem 0.45rem;
      border-radius: 99px;
      font-family: 'JetBrains Mono', monospace;
    }

    .cat-btn.active .cat-count {
      background: var(--accent);
      color: #fff;
    }

    /* â”€â”€ CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .content {
      padding: 1.5rem 2rem;
    }

    .content-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .content-title {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .header-right {
      display: flex;
      gap: 0.6rem;
      align-items: center;
    }

    .item-count-pill {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 99px;
      padding: 0.25rem 0.75rem;
      font-size: 0.72rem;
      color: var(--ink2);
      font-family: 'JetBrains Mono', monospace;
    }

    /* â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.82rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.12s;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .btn-primary:hover {
      background: #245c43;
    }

    .btn-outline {
      background: var(--surface);
      color: var(--ink);
      border-color: var(--border2);
    }

    .btn-outline:hover {
      border-color: var(--ink2);
    }

    .btn-ghost {
      background: none;
      color: var(--ink2);
      border-color: var(--border);
    }

    .btn-ghost:hover {
      color: var(--ink);
      border-color: var(--border2);
    }

    .btn-stock {
      background: var(--amber-l);
      color: var(--amber);
      border-color: #fcd34d;
    }

    .btn-stock:hover {
      background: #fde68a;
    }

    .btn-danger {
      background: none;
      color: var(--red);
      border-color: var(--red-l);
    }

    .btn-danger:hover {
      background: var(--red-l);
    }

    .btn-sm {
      padding: 0.3rem 0.65rem;
      font-size: 0.75rem;
      border-radius: 5px;
    }

    /* â”€â”€ VIEW TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .view-toggle {
      display: flex;
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
    }

    .view-btn {
      background: none;
      border: none;
      padding: 0.4rem 0.6rem;
      cursor: pointer;
      color: var(--ink3);
      font-size: 0.85rem;
      transition: all 0.12s;
    }

    .view-btn.active {
      background: var(--ink);
      color: #fff;
    }

    /* â”€â”€ TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .table-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
    }

    thead th {
      background: var(--card);
      padding: 0.65rem 1rem;
      text-align: left;
      font-size: 0.66rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--ink3);
      font-weight: 500;
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }

    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background 0.1s;
    }

    tbody tr:last-child {
      border-bottom: none;
    }

    tbody tr:hover {
      background: var(--card);
    }

    td {
      padding: 0.8rem 1rem;
      vertical-align: middle;
    }

    .item-name-cell {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .item-name {
      font-weight: 600;
      font-size: 0.88rem;
    }

    .item-meta {
      font-size: 0.7rem;
      color: var(--ink3);
      font-family: 'JetBrains Mono', monospace;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.55rem;
      border-radius: 99px;
      font-size: 0.68rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .badge-cat {
      background: var(--blue-l);
      color: var(--blue);
    }

    .badge-low {
      background: var(--red-l);
      color: var(--red);
    }

    .badge-ok {
      background: var(--accent-l);
      color: var(--accent);
    }

    .qty-cell {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .qty-low {
      color: var(--red);
      font-weight: 700;
    }

    .profit-positive {
      color: var(--accent);
      font-weight: 600;
    }

    .mono {
      font-family: 'JetBrains Mono', monospace;
    }

    .actions {
      display: flex;
      gap: 0.4rem;
    }

    /* â”€â”€ GRID VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1rem;
    }

    .item-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.25rem;
      box-shadow: var(--shadow);
      transition: box-shadow 0.15s;
    }

    .item-card:hover {
      box-shadow: var(--shadow-md);
    }

    .card-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .card-name {
      font-weight: 700;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }

    .card-detail {
      font-size: 0.72rem;
      color: var(--ink2);
      line-height: 1.6;
    }

    .card-divider {
      border: none;
      border-top: 1px solid var(--border);
      margin: 0.85rem 0;
    }

    .card-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }

    .card-stat-label {
      font-size: 0.62rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--ink3);
    }

    .card-stat-val {
      font-size: 0.92rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .card-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .card-actions .btn {
      flex: 1;
      justify-content: center;
    }

    /* â”€â”€ EMPTY STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--ink3);
    }

    .empty-icon {
      font-size: 3.5rem;
      margin-bottom: 1rem;
      display: block;
    }

    .empty h3 {
      color: var(--ink2);
      margin-bottom: 0.4rem;
    }

    .empty p {
      font-size: 0.82rem;
    }

    /* â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(20, 16, 12, 0.5);
      z-index: 200;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .overlay.open {
      display: flex;
    }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      width: 100%;
      max-width: 540px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-md);
      animation: popIn 0.18s ease;
    }

    @keyframes popIn {
      from {
        transform: scale(0.96) translateY(8px);
        opacity: 0;
      }

      to {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    .modal-head {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-weight: 700;
      font-size: 1rem;
    }

    .modal-close {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 6px;
      width: 28px;
      height: 28px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--ink2);
    }

    .modal-close:hover {
      background: var(--border);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .section-divider {
      font-size: 0.63rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--ink3);
      margin: 1.25rem 0 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.85rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .form-group.full {
      grid-column: 1 / -1;
    }

    label {
      font-size: 0.72rem;
      font-weight: 500;
      color: var(--ink2);
    }

    input[type=text],
    input[type=number],
    select,
    textarea {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--ink);
      padding: 0.55rem 0.75rem;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.82rem;
      outline: none;
      transition: border-color 0.15s;
      width: 100%;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent);
    }

    select option {
      background: var(--surface);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .input-with-prefix {
      position: relative;
    }

    .input-prefix {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--ink3);
      font-size: 0.82rem;
      pointer-events: none;
    }

    .input-with-prefix input {
      padding-left: 1.5rem;
    }

    .modal-foot {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 0.6rem;
    }

    /* â”€â”€ CONFIRM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .confirm-box {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      max-width: 360px;
      width: 100%;
      padding: 2rem;
      text-align: center;
      box-shadow: var(--shadow-md);
      animation: popIn 0.18s ease;
    }

    .confirm-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .confirm-box h3 {
      font-size: 1.05rem;
      margin-bottom: 0.5rem;
    }

    .confirm-box p {
      font-size: 0.8rem;
      color: var(--ink2);
      margin-bottom: 1.5rem;
      line-height: 1.5;
    }

    .confirm-actions {
      display: flex;
      gap: 0.6rem;
      justify-content: center;
    }

    /* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toasts {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      z-index: 400;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .toast {
      background: var(--ink);
      color: #fff;
      padding: 0.7rem 1.1rem;
      border-radius: 8px;
      font-size: 0.8rem;
      min-width: 220px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: var(--shadow-md);
      animation: slideLeft 0.2s ease;
    }

    @keyframes slideLeft {
      from {
        transform: translateX(16px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.error {
      background: var(--red);
    }

    .toast.success {
      background: var(--accent);
    }

    /* â”€â”€ MOBILE BOTTOM NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      border-top: 1px solid var(--border);
      z-index: 150;
      padding: 0.5rem 0 calc(0.5rem + env(safe-area-inset-bottom));
      grid-template-columns: repeat(4, 1fr);
    }

    .bnav-btn {
      background: none;
      border: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.2rem;
      padding: 0.3rem 0;
      cursor: pointer;
      color: var(--ink3);
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.6rem;
      font-weight: 500;
      transition: color 0.15s;
    }

    .bnav-btn .bnav-icon {
      font-size: 1.3rem;
      line-height: 1;
    }

    .bnav-btn.active {
      color: var(--accent);
    }

    /* â”€â”€ MOBILE FILTER DRAWER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .drawer-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 180;
    }

    .drawer-overlay.open {
      display: block;
    }

    .drawer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      border-radius: 16px 16px 0 0;
      z-index: 190;
      padding: 1rem 1.25rem calc(1.5rem + env(safe-area-inset-bottom));
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(.4, 0, .2, 1);
      max-height: 80vh;
      overflow-y: auto;
    }

    .drawer.open {
      transform: translateY(0);
    }

    .drawer-handle {
      width: 40px;
      height: 4px;
      background: var(--border2);
      border-radius: 99px;
      margin: 0 auto 1.25rem;
    }

    .drawer-title {
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .drawer-cats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }

    .drawer-cat-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.65rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--card);
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.8rem;
      cursor: pointer;
      color: var(--ink);
      transition: all 0.12s;
    }

    .drawer-cat-btn.active {
      background: var(--accent-l);
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 600;
    }

    /* â”€â”€ MOBILE SEARCH BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .mobile-search-bar {
      display: none;
      padding: 0.75rem 1rem;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 56px;
      z-index: 90;
    }

    .mobile-search-bar .search-wrap {
      margin-bottom: 0;
    }

    /* â”€â”€ MOBILE ITEM CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .mobile-cards {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .mobile-item-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: var(--shadow);
    }

    .mic-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.6rem;
    }

    .mic-left {
      flex: 1;
      min-width: 0;
    }

    .mic-name {
      font-weight: 700;
      font-size: 0.95rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 0.2rem;
    }

    .mic-meta {
      font-size: 0.72rem;
      color: var(--ink2);
    }

    .mic-qty {
      text-align: right;
      flex-shrink: 0;
      margin-left: 0.75rem;
    }

    .mic-qty-num {
      font-size: 1.6rem;
      font-weight: 800;
      font-family: 'JetBrains Mono', monospace;
      line-height: 1;
    }

    .mic-qty-label {
      font-size: 0.65rem;
      color: var(--ink3);
    }

    .mic-badges {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
      margin-bottom: 0.85rem;
    }

    .mic-actions {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 0.4rem;
    }

    .mic-actions .btn {
      justify-content: center;
      font-size: 0.75rem;
      padding: 0.5rem 0.4rem;
    }

    /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 820px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .sidebar {
        display: none;
      }

      .stats-row {
        grid-template-columns: repeat(3, 1fr) !important;
      }

      .stat {
        padding: 0.75rem 1rem;
      }

      .stat-val {
        font-size: 1.2rem;
      }

      .content {
        padding: 1rem;
        padding-bottom: 5rem;
      }

      .topbar {
        padding: 0 1rem;
      }

      .topbar-hint {
        display: none;
      }

      .content-header {
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .header-right {
        width: 100%;
        justify-content: space-between;
      }

      /* Hide table on mobile only, grid still works */
      .table-card {
        display: none !important;
      }

      .items-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 820px) {
      .bottom-nav {
        display: grid;
      }

      .mobile-search-bar {
        display: block;
      }
    }

    @media (max-width: 480px) {
      .stats-row {
        grid-template-columns: repeat(3, 1fr) !important;
      }

      .stat-label {
        font-size: 0.58rem;
      }

      .stat-sub {
        display: none;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .items-grid {
        grid-template-columns: 1fr;
      }

      .modal {
        border-radius: 16px 16px 0 0;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        max-width: 100%;
        max-height: 92vh;
      }

      .overlay {
        align-items: flex-end;
        padding: 0;
      }
    }
  </style>
</head>

<body>

  <!-- TOP BAR -->
  <nav class="topbar">
    <div class="logo">
      <div class="logo-icon">ğŸ›</div>
      JS<span style="color:#6ee7b7">Inventory</span>
    </div>
    <div class="topbar-right">
      <span class="topbar-hint" id="topbarDate"></span>
      <button class="btn btn-primary" style="font-size:0.82rem;" onclick="openAdd()">ï¼‹ Add Item</button>
    </div>
  </nav>

  <!-- MOBILE SEARCH BAR (shown only on mobile) -->
  <div class="mobile-search-bar">
    <div class="search-wrap">
      <input class="search-input" id="mobileSearchInput" type="text" placeholder="ğŸ”Search productsâ€¦"
        oninput="onMobileSearch()" />
    </div>
  </div>

  <!-- STATS ROW -->
  <div class="stats-row" style="grid-template-columns: repeat(3, 1fr);">
    <div class="stat">
      <div class="stat-label">Total Products</div>
      <div class="stat-val" id="s-total">â€”</div>
      <div class="stat-sub">SKUs in inventory</div>
    </div>
    <div class="stat">
      <div class="stat-label">Low Stock Alerts</div>
      <div class="stat-val red" id="s-low">â€”</div>
      <div class="stat-sub">need restocking</div>
    </div>
    <div class="stat">
      <div class="stat-label">Categories</div>
      <div class="stat-val green" id="s-cats">â€”</div>
      <div class="stat-sub">product types</div>
    </div>
  </div>

  <!-- LAYOUT -->
  <div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="search-wrap">
          <input class="search-input" id="searchInput" type="text" placeholder="ğŸ”Search productsâ€¦"
            oninput="onSearch()" />
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Categories</div>
        <div id="catList">
          <button class="cat-btn active" data-cat="All" onclick="selectCat('All',this)">
            <span class="cat-icon">ğŸ“¦</span> All Items
            <span class="cat-count" id="cnt-all">0</span>
          </button>
          <button class="cat-btn" data-cat="Paper Plates" onclick="selectCat('Paper Plates',this)">
            <span class="cat-icon">ğŸ½</span> Paper Plates
            <span class="cat-count" id="cnt-Paper Plates">0</span>
          </button>
          <button class="cat-btn" data-cat="Carry Bags" onclick="selectCat('Carry Bags',this)">
            <span class="cat-icon">ğŸ›</span> Carry Bags
            <span class="cat-count" id="cnt-Carry Bags">0</span>
          </button>
          <button class="cat-btn" data-cat="Cups & Glasses" onclick="selectCat('Cups & Glasses',this)">
            <span class="cat-icon">ğŸ¥¤</span> Cups & Glasses
            <span class="cat-count" id="cnt-Cups & Glasses">0</span>
          </button>
          <button class="cat-btn" data-cat="Tissue & Napkins" onclick="selectCat('Tissue & Napkins',this)">
            <span class="cat-icon">ğŸ§»</span> Tissue & Napkins
            <span class="cat-count" id="cnt-Tissue & Napkins">0</span>
          </button>
          <button class="cat-btn" data-cat="Boxes & Trays" onclick="selectCat('Boxes & Trays',this)">
            <span class="cat-icon">ğŸ“«</span> Boxes & Trays
            <span class="cat-count" id="cnt-Boxes & Trays">0</span>
          </button>
          <button class="cat-btn" data-cat="Other" onclick="selectCat('Other',this)">
            <span class="cat-icon">ğŸ·</span> Other
            <span class="cat-count" id="cnt-Other">0</span>
          </button>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Legend</div>
        <div style="font-size:0.74rem;color:var(--ink2);line-height:2;padding:0 0.5rem;">
          <span style="color:var(--red);">â— Low stock</span> â€” qty â‰¤ threshold<br>
          <span style="color:var(--accent);">â— In stock</span> â€” qty &gt; threshold
        </div>
      </div>
    </aside>

    <!-- CONTENT -->
    <main class="content">
      <div class="content-header">
        <div style="display:flex;align-items:center;gap:0.75rem;">
          <span class="content-title" id="pageTitle">All Items</span>
          <span class="item-count-pill" id="itemCount">0 items</span>
        </div>
        <div class="header-right">
          <div class="view-toggle">
            <button class="view-btn active" id="vb-table" onclick="setView('table')" title="Table view">â˜°</button>
            <button class="view-btn" id="vb-grid" onclick="setView('grid')" title="Grid view">âŠ</button>
          </div>
          <button class="btn btn-outline btn-sm" onclick="exportCSV()">â¬‡ Export CSV</button>
        </div>
      </div>

      <div id="viewContainer">
        <div style="padding:3rem;text-align:center;color:var(--ink3);">Loading inventoryâ€¦</div>
      </div>
    </main>
  </div>

  <!-- â”€â”€ ADD / EDIT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="overlay" id="itemOverlay">
    <div class="modal">
      <div class="modal-head">
        <span class="modal-title" id="modalTitle">Add Item</span>
        <button class="modal-close" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <form id="itemForm" onsubmit="submitForm(event)">

          <div class="section-divider">Product Info</div>
          <div class="form-grid">
            <div class="form-group full">
              <label>Product Name *</label>
              <input type="text" id="f-name" required placeholder="e.g. Round Paper Plates 8 inch" />
            </div>
            <div class="form-group">
              <label>Category *</label>
              <select id="f-category" required>
                <option value="Paper Plates">ğŸ½ Paper Plates</option>
                <option value="Carry Bags">ğŸ› Carry Bags</option>
                <option value="Cups & Glasses">ğŸ¥¤ Cups & Glasses</option>
                <option value="Tissue & Napkins">ğŸ§» Tissue & Napkins</option>
                <option value="Boxes & Trays">ğŸ“« Boxes & Trays</option>
                <option value="Other">ğŸ· Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>Size / Variant</label>
              <input type="text" id="f-size" placeholder="e.g. 8 inch, 500ml, 30Ã—40cm" />
            </div>
            <div class="form-group">
              <label>Material</label>
              <input type="text" id="f-material" placeholder="e.g. Paper, LDPE, Aluminium" />
            </div>
            <div class="form-group">
              <label>Supplier</label>
              <input type="text" id="f-supplier" placeholder="Supplier / Brand name" />
            </div>
          </div>

          <div class="section-divider">Stock Details</div>
          <div class="form-grid">
            <div class="form-group">
              <label>Unit Type *</label>
              <select id="f-unitType">
                <option>Pack</option>
                <option>Bundle</option>
                <option>Roll</option>
                <option>Box</option>
                <option>Carton</option>
                <option>Piece</option>
                <option>Dozen</option>
                <option>Gross</option>
                <option>Kg</option>
              </select>
            </div>
            <div class="form-group">
              <label>Pcs per Unit</label>
              <input type="number" id="f-pcsPerUnit" min="1" value="1" placeholder="e.g. 25, 50, 100" />
            </div>
            <div class="form-group">
              <label>Quantity in Stock *</label>
              <input type="number" id="f-quantity" required min="0" placeholder="0" />
            </div>
            <div class="form-group">
              <label>Low-Stock Alert (units)</label>
              <input type="number" id="f-threshold" min="0" placeholder="10" />
            </div>
          </div>

          <div class="section-divider">Notes</div>
          <div class="form-group">
            <label>Additional Notes</label>
            <textarea id="f-notes" placeholder="e.g. Biodegradable, GST applicable, seasonal itemâ€¦"></textarea>
          </div>

        </form>
      </div>
      <div class="modal-foot">
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('itemForm').requestSubmit()" id="submitBtn">Add
          Item</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ STOCK ADJUSTMENT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="overlay" id="stockOverlay">
    <div class="modal" style="max-width:400px;">
      <div class="modal-head">
        <span class="modal-title">Adjust Stock</span>
        <button class="modal-close" onclick="closeStock()">âœ•</button>
      </div>
      <div class="modal-body">
        <div id="stockItemName" style="font-weight:700;font-size:1rem;margin-bottom:0.25rem;"></div>
        <div id="stockItemMeta" style="font-size:0.78rem;color:var(--ink2);margin-bottom:1.5rem;"></div>

        <!-- Current qty display -->
        <div
          style="background:var(--card);border:1px solid var(--border);border-radius:8px;padding:1rem;text-align:center;margin-bottom:1.25rem;">
          <div
            style="font-size:0.65rem;text-transform:uppercase;letter-spacing:2px;color:var(--ink3);margin-bottom:0.25rem;">
            Current Stock</div>
          <div style="font-size:2rem;font-weight:700;font-family:'JetBrains Mono',monospace;" id="stockCurrentQty">â€”
          </div>
          <div style="font-size:0.75rem;color:var(--ink2);" id="stockUnitLabel">units</div>
        </div>

        <!-- Quick buttons -->
        <div style="margin-bottom:1rem;">
          <div
            style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--ink3);margin-bottom:0.6rem;">
            Quick Adjust</div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem;">
            <button class="btn btn-outline" style="justify-content:center;color:var(--red);border-color:#fca5a5;"
              onclick="quickAdjust(-1)">âˆ’ 1</button>
            <button class="btn btn-outline" style="justify-content:center;color:var(--red);border-color:#fca5a5;"
              onclick="quickAdjust(-5)">âˆ’ 5</button>
            <button class="btn btn-outline" style="justify-content:center;color:var(--red);border-color:#fca5a5;"
              onclick="quickAdjust(-10)">âˆ’ 10</button>
            <button class="btn btn-outline" style="justify-content:center;color:var(--accent);border-color:#6ee7b7;"
              onclick="quickAdjust(1)">+ 1</button>
            <button class="btn btn-outline" style="justify-content:center;color:var(--accent);border-color:#6ee7b7;"
              onclick="quickAdjust(5)">+ 5</button>
            <button class="btn btn-outline" style="justify-content:center;color:var(--accent);border-color:#6ee7b7;"
              onclick="quickAdjust(10)">+ 10</button>
          </div>
        </div>

        <!-- Custom amount -->
        <div style="margin-bottom:0.5rem;">
          <div
            style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--ink3);margin-bottom:0.6rem;">
            Custom Amount</div>
          <div style="display:flex;gap:0.5rem;">
            <button class="btn btn-outline" style="color:var(--red);border-color:#fca5a5;padding:0.5rem 0.9rem;"
              onclick="applyCustom(-1)">âˆ’ Remove</button>
            <input type="number" id="stockCustom" min="1" value="1" placeholder="qty"
              style="flex:1;text-align:center;font-size:1rem;font-weight:600;" />
            <button class="btn btn-outline" style="color:var(--accent);border-color:#6ee7b7;padding:0.5rem 0.9rem;"
              onclick="applyCustom(1)">+ Add</button>
          </div>
        </div>

        <!-- Set exact -->
        <div style="margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border);">
          <div
            style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--ink3);margin-bottom:0.6rem;">
            Set Exact Quantity</div>
          <div style="display:flex;gap:0.5rem;">
            <input type="number" id="stockExact" min="0" placeholder="e.g. 50" style="flex:1;" />
            <button class="btn btn-primary" onclick="applyExact()">Set</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ CONFIRM DELETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="overlay" id="confirmOverlay">
    <div class="confirm-box">
      <div class="confirm-icon">ğŸ—‘ï¸</div>
      <h3>Remove this item?</h3>
      <p>This will permanently delete the product from your inventory. This action cannot be undone.</p>
      <div class="confirm-actions">
        <button class="btn btn-outline" onclick="closeConfirm()">Keep it</button>
        <button class="btn btn-danger" onclick="doDelete()">Yes, Delete</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ MOBILE BOTTOM NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="bottom-nav" id="bottomNav">
    <button class="bnav-btn active" id="bnav-home" onclick="bnav('home')">
      <span class="bnav-icon">ğŸ“¦</span>Items
    </button>
    <button class="bnav-btn" id="bnav-filter" onclick="openDrawer()">
      <span class="bnav-icon">ğŸ—‚</span>Category
    </button>
    <button class="bnav-btn" id="bnav-export" onclick="exportCSV()">
      <span class="bnav-icon">â¬‡</span>Export
    </button>
    <button class="bnav-btn" id="bnav-add" onclick="openAdd()">
      <span class="bnav-icon">â•</span>Add Item
    </button>
  </nav>

  <!-- â”€â”€ CATEGORY DRAWER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
  <div class="drawer" id="catDrawer">
    <div class="drawer-handle"></div>
    <div class="drawer-title">Filter by Category</div>
    <div class="drawer-cats">
      <button class="drawer-cat-btn active" onclick="drawerCat('All',this)">ğŸ“¦ All Items</button>
      <button class="drawer-cat-btn" onclick="drawerCat('Paper Plates',this)">ğŸ½ Paper Plates</button>
      <button class="drawer-cat-btn" onclick="drawerCat('Carry Bags',this)">ğŸ› Carry Bags</button>
      <button class="drawer-cat-btn" onclick="drawerCat('Cups & Glasses',this)">ğŸ¥¤ Cups & Glasses</button>
      <button class="drawer-cat-btn" onclick="drawerCat('Tissue & Napkins',this)">ğŸ§» Tissue & Napkins</button>
      <button class="drawer-cat-btn" onclick="drawerCat('Boxes & Trays',this)">ğŸ“« Boxes & Trays</button>
      <button class="drawer-cat-btn" onclick="drawerCat('Other',this)">ğŸ· Other</button>
    </div>
  </div>

  <!-- â”€â”€ TOASTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="toasts" id="toasts"></div>

  <script>
    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let items = [];
    let allItems = [];
    let currentCat = 'All';
    let currentSearch = '';
    let currentView = 'table';
    let editingId = null;
    let deletingId = null;

    const CAT_ICONS = {
      'Paper Plates': 'ğŸ½', 'Carry Bags': 'ğŸ›', 'Cups & Glasses': 'ğŸ¥¤',
      'Tissue & Napkins': 'ğŸ§»',
      'Boxes & Trays': 'ğŸ“«', 'Other': 'ğŸ·'
    };

    const CATS = Object.keys(CAT_ICONS);

    // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const fmt = n => 'â‚¹' + Number(n).toLocaleString('en-IN', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
    const fmt2 = n => 'â‚¹' + Number(n).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const esc = s => String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');

    async function api(path, opts = {}) {
      const r = await fetch('/api' + path, { headers: { 'Content-Type': 'application/json' }, ...opts });
      if (!r.ok) { const e = await r.json(); throw new Error(e.error || 'Error'); }
      return r.json();
    }

    function toast(msg, type = 'success') {
      const el = document.createElement('div');
      el.className = `toast ${type}`;
      el.innerHTML = `<span>${type === 'success' ? 'âœ“' : 'âœ•'}</span> ${msg}`;
      document.getElementById('toasts').appendChild(el);
      setTimeout(() => el.remove(), 3000);
    }

    // â”€â”€ Date â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('topbarDate').textContent =
      new Date().toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });

    // â”€â”€ Data Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadStats() {
      try {
        const s = await api('/stats');
        document.getElementById('s-total').textContent = s.totalItems;
        document.getElementById('s-low').textContent = s.lowStock;
        document.getElementById('s-cats').textContent = (s.catBreakdown || []).length;

        // update sidebar counts
        const counts = {};
        (s.catBreakdown || []).forEach(c => counts[c._id] = c.count);
        document.getElementById('cnt-all').textContent = s.totalItems;
        CATS.forEach(c => {
          const el = document.getElementById('cnt-' + c);
          if (el) el.textContent = counts[c] || 0;
        });
      } catch { }
    }

    async function loadItems() {
      const params = new URLSearchParams();
      if (currentSearch) params.set('search', currentSearch);
      if (currentCat !== 'All') params.set('category', currentCat);
      items = await api('/items?' + params);
      renderView();
    }

    // Also fetch all for CSV export
    async function loadAll() {
      allItems = await api('/items');
    }

    async function refresh() {
      await Promise.all([loadItems(), loadStats(), loadAll()]);
    }

    // â”€â”€ Category Filter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function selectCat(cat, el) {
      currentCat = cat;
      document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
      el.classList.add('active');
      document.getElementById('pageTitle').textContent = cat === 'All' ? 'All Items' : cat;
      loadItems();
    }

    let searchTimer;
    function onSearch() {
      clearTimeout(searchTimer);
      searchTimer = setTimeout(() => {
        currentSearch = document.getElementById('searchInput').value.trim();
        loadItems();
      }, 280);
    }

    // â”€â”€ View Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setView(v) {
      currentView = v;
      document.getElementById('vb-table').classList.toggle('active', v === 'table');
      document.getElementById('vb-grid').classList.toggle('active', v === 'grid');
      // update bottom nav icon to reflect current view
      const bnavHome = document.getElementById('bnav-home');
      if (bnavHome) {
        bnavHome.querySelector('.bnav-icon').textContent = v === 'grid' ? 'âŠ' : 'â˜°';
        bnavHome.querySelector('span:last-child') && (bnavHome.lastChild.textContent = v === 'grid' ? 'Grid' : 'List');
      }
      renderView();
    }

    function renderView() {
      document.getElementById('itemCount').textContent = `${items.length} item${items.length !== 1 ? 's' : ''}`;
      currentView === 'grid' ? renderGrid() : renderTable();
    }

    // â”€â”€ Table Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderTable() {
      const c = document.getElementById('viewContainer');

      if (!items.length) { c.innerHTML = emptyState(); return; }

      c.innerHTML = `
    <div class="table-card">
      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Category</th>
            <th>Size / Unit</th>
            <th>Stock</th>
            <th>Status</th>
            <th>Supplier</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${items.map(item => {
        const isLow = item.quantity <= item.threshold;
        return `
              <tr>
                <td>
                  <div class="item-name-cell">
                    <span class="item-name">${esc(item.name)}</span>
                    ${item.material ? `<span class="item-meta">${esc(item.material)}</span>` : ''}
                  </div>
                </td>
                <td><span class="badge badge-cat">${CAT_ICONS[item.category] || 'ğŸ“¦'} ${esc(item.category)}</span></td>
                <td class="mono" style="font-size:0.78rem;color:var(--ink2);">
                  ${esc(item.size || 'â€”')}<br>
                  <span style="color:var(--ink3);font-size:0.7rem;">${item.pcsPerUnit} pcs/${esc(item.unitType)}</span>
                </td>
                <td>
                  <div class="qty-cell">
                    <span class="${isLow ? 'qty-low' : ''} mono">${item.quantity}</span>
                    <span style="font-size:0.7rem;color:var(--ink3);">${esc(item.unitType)}s</span>
                  </div>
                </td>
                <td>
                  <span class="badge ${isLow ? 'badge-low' : 'badge-ok'}">
                    ${isLow ? 'âš  Low' : 'âœ“ OK'}
                  </span>
                </td>
                <td style="color:var(--ink2);font-size:0.78rem;">${esc(item.supplier || 'â€”')}</td>
                <td>
                  <div class="actions">
                    <button class="btn btn-stock btn-sm" onclick="openStock('${item._id}')">Â± Stock</button>
                    <button class="btn btn-ghost btn-sm" onclick="openEdit('${item._id}')">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="openConfirm('${item._id}')">Del</button>
                  </div>
                </td>
              </tr>`;
      }).join('')}
        </tbody>
      </table>
    </div>`;
    }

    // â”€â”€ Grid Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderGrid() {
      const c = document.getElementById('viewContainer');

      if (!items.length) { c.innerHTML = emptyState(); return; }

      c.innerHTML = `<div class="items-grid">${items.map(item => {
        const isLow = item.quantity <= item.threshold;
        return `
        <div class="item-card">
          <div class="card-top">
            <div class="card-icon">${CAT_ICONS[item.category] || 'ğŸ“¦'}</div>
            <span class="badge ${isLow ? 'badge-low' : 'badge-ok'}">${isLow ? 'âš  Low' : 'âœ“ OK'}</span>
          </div>
          <div class="card-name">${esc(item.name)}</div>
          <div class="card-detail">
            ${item.size ? `ğŸ“ ${esc(item.size)}<br>` : ''}
            ${item.material ? `ğŸ§± ${esc(item.material)}<br>` : ''}
            ğŸ“¦ ${item.pcsPerUnit} pcs / ${esc(item.unitType)}
            ${item.supplier ? `<br>ğŸ­ ${esc(item.supplier)}` : ''}
          </div>
          <hr class="card-divider"/>
          <div class="card-stats">
            <div>
              <div class="card-stat-label">In Stock</div>
              <div class="card-stat-val" style="color:${isLow ? 'var(--red)' : 'var(--ink)'}">${item.quantity} ${esc(item.unitType)}s</div>
            </div>
            <div>
              <div class="card-stat-label">Low Stock At</div>
              <div class="card-stat-val">${item.threshold} ${esc(item.unitType)}s</div>
            </div>
          </div>
          <div class="card-actions">
            <button class="btn btn-stock btn-sm" style="flex:1;justify-content:center;" onclick="openStock('${item._id}')">Â± Stock</button>
            <button class="btn btn-outline btn-sm" onclick="openEdit('${item._id}')">âœ Edit</button>
            <button class="btn btn-danger btn-sm" onclick="openConfirm('${item._id}')">ğŸ—‘</button>
          </div>
        </div>`;
      }).join('')
        }</div>`;
    }

    function emptyState() {
      return `<div class="empty">
    <span class="empty-icon">ğŸ“­</span>
    <h3>No items found</h3>
    <p>Try a different filter or add your first product.</p>
  </div>`;
    }

    // â”€â”€ Modal: Add â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openAdd() {
      editingId = null;
      document.getElementById('modalTitle').textContent = 'Add Product';
      document.getElementById('submitBtn').textContent = 'Add Item';
      document.getElementById('itemForm').reset();
      document.getElementById('f-pcsPerUnit').value = 1;
      document.getElementById('f-threshold').value = 10;
      document.getElementById('itemOverlay').classList.add('open');
    }

    // â”€â”€ Modal: Edit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openEdit(id) {
      const item = items.find(i => i._id === id);
      if (!item) return;
      editingId = id;
      document.getElementById('modalTitle').textContent = 'Edit Product';
      document.getElementById('submitBtn').textContent = 'Save Changes';

      document.getElementById('f-name').value = item.name;
      document.getElementById('f-category').value = item.category;
      document.getElementById('f-size').value = item.size || '';
      document.getElementById('f-material').value = item.material || '';
      document.getElementById('f-supplier').value = item.supplier || '';
      document.getElementById('f-unitType').value = item.unitType;
      document.getElementById('f-pcsPerUnit').value = item.pcsPerUnit;
      document.getElementById('f-quantity').value = item.quantity;
      document.getElementById('f-threshold').value = item.threshold;
      document.getElementById('f-notes').value = item.notes || '';

      document.getElementById('itemOverlay').classList.add('open');
    }

    function closeModal() {
      document.getElementById('itemOverlay').classList.remove('open');
    }

    // â”€â”€ Form Submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function submitForm(e) {
      e.preventDefault();
      const payload = {
        name: document.getElementById('f-name').value.trim(),
        category: document.getElementById('f-category').value,
        size: document.getElementById('f-size').value.trim(),
        material: document.getElementById('f-material').value.trim(),
        supplier: document.getElementById('f-supplier').value.trim(),
        unitType: document.getElementById('f-unitType').value,
        pcsPerUnit: Number(document.getElementById('f-pcsPerUnit').value) || 1,
        quantity: Number(document.getElementById('f-quantity').value),
        threshold: Number(document.getElementById('f-threshold').value) || 10,

        notes: document.getElementById('f-notes').value.trim(),
      };
      try {
        if (editingId) {
          await api('/items/' + editingId, { method: 'PUT', body: JSON.stringify(payload) });
          toast('Product updated!');
        } else {
          await api('/items', { method: 'POST', body: JSON.stringify(payload) });
          toast('Product added!');
        }
        closeModal();
        refresh();
      } catch (err) { toast(err.message, 'error'); }
    }

    // â”€â”€ Stock Adjustment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let stockItem = null;

    function openStock(id) {
      stockItem = items.find(i => i._id === id);
      if (!stockItem) return;
      document.getElementById('stockItemName').textContent = stockItem.name;
      document.getElementById('stockItemMeta').textContent =
        `${stockItem.category}${stockItem.size ? ' Â· ' + stockItem.size : ''}`;
      document.getElementById('stockCurrentQty').textContent = stockItem.quantity;
      document.getElementById('stockUnitLabel').textContent = stockItem.unitType + 's';
      document.getElementById('stockCustom').value = 1;
      document.getElementById('stockExact').value = '';
      document.getElementById('stockOverlay').classList.add('open');
    }

    function closeStock() {
      document.getElementById('stockOverlay').classList.remove('open');
      stockItem = null;
    }

    async function updateQty(newQty) {
      if (!stockItem) return;
      if (newQty < 0) { toast('Stock cannot go below 0', 'error'); return; }
      try {
        await api('/items/' + stockItem._id, {
          method: 'PUT',
          body: JSON.stringify({ ...stockItem, quantity: newQty })
        });
        stockItem.quantity = newQty;
        document.getElementById('stockCurrentQty').textContent = newQty;
        toast(`Stock updated â†’ ${newQty} ${stockItem.unitType}s`);
        loadItems();
        loadStats();
      } catch (err) { toast(err.message, 'error'); }
    }

    function quickAdjust(delta) {
      if (!stockItem) return;
      updateQty(stockItem.quantity + delta);
    }

    function applyCustom(sign) {
      const amt = parseInt(document.getElementById('stockCustom').value) || 0;
      if (amt <= 0) { toast('Enter a valid amount', 'error'); return; }
      updateQty(stockItem.quantity + (sign * amt));
    }

    function applyExact() {
      const val = parseInt(document.getElementById('stockExact').value);
      if (isNaN(val) || val < 0) { toast('Enter a valid quantity', 'error'); return; }
      updateQty(val);
    }

    document.getElementById('stockOverlay').addEventListener('click', e => {
      if (e.target === document.getElementById('stockOverlay')) closeStock();
    });

    // â”€â”€ Delete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openConfirm(id) {
      deletingId = id;
      document.getElementById('confirmOverlay').classList.add('open');
    }
    function closeConfirm() {
      document.getElementById('confirmOverlay').classList.remove('open');
      deletingId = null;
    }
    async function doDelete() {
      if (!deletingId) return;
      try {
        await api('/items/' + deletingId, { method: 'DELETE' });
        toast('Product deleted');
        closeConfirm();
        refresh();
      } catch (err) { toast(err.message, 'error'); closeConfirm(); }
    }

    // â”€â”€ Export CSV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function exportCSV() {
      if (!allItems.length) { toast('No items to export', 'error'); return; }
      const headers = ['Name', 'Category', 'Size', 'Material', 'Unit Type', 'Pcs/Unit', 'Quantity', 'Supplier', 'Low Stock Threshold', 'Notes'];
      const rows = allItems.map(i => [
        `"${i.name}"`, `"${i.category}"`, `"${i.size || ''}"`, `"${i.material || ''}"`,
        i.unitType, i.pcsPerUnit, i.quantity,
        `"${i.supplier || ''}"`, i.threshold, `"${i.notes || ''}"`
      ]);
      const csv = [headers, ...rows].map(r => r.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `inventory_${new Date().toISOString().slice(0, 10)}.csv`;
      a.click();
      toast('CSV exported!');
    }

    // â”€â”€ Mobile Drawer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openDrawer() {
      document.getElementById('catDrawer').classList.add('open');
      document.getElementById('drawerOverlay').classList.add('open');
    }
    function closeDrawer() {
      document.getElementById('catDrawer').classList.remove('open');
      document.getElementById('drawerOverlay').classList.remove('open');
    }
    function drawerCat(cat, el) {
      // sync with sidebar
      currentCat = cat;
      document.querySelectorAll('.drawer-cat-btn').forEach(b => b.classList.remove('active'));
      el.classList.add('active');
      document.getElementById('pageTitle').textContent = cat === 'All' ? 'All Items' : cat;
      // also sync desktop sidebar
      document.querySelectorAll('.cat-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.cat === cat);
      });
      closeDrawer();
      loadItems();
    }

    // â”€â”€ Mobile Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let mobileSearchTimer;
    function onMobileSearch() {
      clearTimeout(mobileSearchTimer);
      mobileSearchTimer = setTimeout(() => {
        currentSearch = document.getElementById('mobileSearchInput').value.trim();
        // sync desktop search
        document.getElementById('searchInput').value = currentSearch;
        loadItems();
      }, 280);
    }

    // â”€â”€ Bottom Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function bnav(tab) {
      document.querySelectorAll('.bnav-btn').forEach(b => b.classList.remove('active'));
      const el = document.getElementById('bnav-' + tab);
      if (el) el.classList.add('active');
      if (tab === 'home') {
        window.scrollTo({ top: 0, behavior: 'smooth' });
        refresh();
        toast('List refreshed!');
      }
    }

    // â”€â”€ Mobile card render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function isMobile() { return window.innerWidth <= 820; }

    // Override renderView to handle both mobile and desktop
    function renderView() {
      document.getElementById('itemCount').textContent = `${items.length} item${items.length !== 1 ? 's' : ''}`;
      if (isMobile()) {
        // on mobile: list = mobile cards, grid = grid cards
        if (currentView === 'grid') {
          renderGrid();
        } else {
          renderMobileCards();
        }
      } else {
        currentView === 'grid' ? renderGrid() : renderTable();
      }
    }

    function renderMobileCards() {
      const c = document.getElementById('viewContainer');
      if (!items.length) { c.innerHTML = emptyState(); return; }

      c.innerHTML = `<div class="mobile-cards">${items.map(item => {
        const isLow = item.quantity <= item.threshold;
        return `
        <div class="mobile-item-card">
          <div class="mic-top">
            <div class="mic-left">
              <div class="mic-name">${esc(item.name)}</div>
              <div class="mic-meta">
                ${CAT_ICONS[item.category] || 'ğŸ“¦'} ${esc(item.category)}
                ${item.size ? ' Â· ' + esc(item.size) : ''}
                ${item.material ? ' Â· ' + esc(item.material) : ''}
              </div>
            </div>
            <div class="mic-qty">
              <div class="mic-qty-num" style="color:${isLow ? 'var(--red)' : 'var(--ink)'}">${item.quantity}</div>
              <div class="mic-qty-label">${esc(item.unitType)}s</div>
            </div>
          </div>
          <div class="mic-badges">
            <span class="badge ${isLow ? 'badge-low' : 'badge-ok'}">${isLow ? 'âš  Low Stock' : 'âœ“ In Stock'}</span>
            ${item.pcsPerUnit > 1 ? `<span class="badge badge-cat">${item.pcsPerUnit} pcs/${esc(item.unitType)}</span>` : ''}
            ${item.supplier ? `<span class="badge" style="background:var(--card);border:1px solid var(--border);color:var(--ink2);">ğŸ­ ${esc(item.supplier)}</span>` : ''}
          </div>
          <div class="mic-actions">
            <button class="btn btn-stock" onclick="openStock('${item._id}')">Â± Stock</button>
            <button class="btn btn-outline" onclick="openEdit('${item._id}')">âœ Edit</button>
            <button class="btn btn-danger" onclick="openConfirm('${item._id}')">ğŸ—‘ Del</button>
          </div>
        </div>`;
      }).join('')
        }</div>`;
    }

    window.addEventListener('resize', () => { if (items.length) renderView(); });

    // â”€â”€ Close overlays on backdrop click â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('itemOverlay').addEventListener('click', e => {
      if (e.target === document.getElementById('itemOverlay')) closeModal();
    });
    document.getElementById('confirmOverlay').addEventListener('click', e => {
      if (e.target === document.getElementById('confirmOverlay')) closeConfirm();
    });

    // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    refresh();
  </script>
</body>

</html>